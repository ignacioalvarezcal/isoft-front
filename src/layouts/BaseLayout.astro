---
import "../styles/global.scss";
import { ClientRouter } from "astro:transitions";
import SpaceBackground from "../components/SpaceBackground.astro";
interface Props {
  title?: string;
  description?: string;
}

const {
  title = "ISOFT- Transformación digital",
  description = "Consultoría tecnológica especializada en transformación digital empresarial, software a medida, inteligencia artificial, análisis y procesamiento de datos",
} = Astro.props as Props;
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <!-- Preconnect to Google Fonts for faster loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <ClientRouter fallback="swap" />
  </head>

  <body class="page">
    <SpaceBackground transition:persist />
    <slot />

    <!-- JS para parallax + animaciones - optimizado para View Transitions -->
    <script is:inline>
      function initPageScripts() {
        // Parallax blobs
        const parallaxEls = document.querySelectorAll("[data-parallax]");

        const handleScroll = () => {
          const scrollY = window.scrollY || window.pageYOffset;

          parallaxEls.forEach((el) => {
            const speed = Number(el.getAttribute("data-speed") || "0.3");
            el.style.transform = `translateY(${scrollY * speed * 0.5}px)`;
          });
        };

        window.addEventListener("scroll", handleScroll);
        handleScroll();

        // IntersectionObserver para .fade-in-up
        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("visible");
                observer.unobserve(entry.target);
              }
            });
          },
          { threshold: 0.1, rootMargin: "50px" },
        );

        document
          .querySelectorAll("[data-animate]")
          .forEach((el) => observer.observe(el));
      }

      // Run on initial load and after View Transitions navigation
      initPageScripts();
      document.addEventListener("astro:page-load", initPageScripts);
    </script>
  </body>
</html>
